generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

model Category {
  id       Int    @id @default(autoincrement())
  title    String @unique
  img_href String
}

model ContentType {
  id    Int    @id @default(autoincrement())
  title String @unique
}

model Course {
  id          Int    @id @default(autoincrement())
  title       String @db.MediumText
  description String @db.LongText
  category    String
  categoryId  Int

  current_price  Decimal
  original_price Decimal

  instructor   String
  instructorId Int

  organization           String?
  difficulty             String
  img_href               String
  estimated_time_hours   Int
  estimated_time_minutes Int
  lesson_cnt             Int
  rating_cnt             Int
  rating_avg             Float

  @@index([categoryId])
  @@index([instructorId])
  @@index([title(length: 100), description(length: 500)], map: "course_fulltext")
}

model CourseContent {
  id            Int  @id @default(autoincrement())
  contentTypeId Int
  lessonId      Int?
  content       Json
  authorId      Int

  @@index([authorId])
  @@index([contentTypeId])
  @@index([lessonId])
}

model CourseProgres {
  user_id           Int
  lessons_completed Int
  course_id         Int

  @@id([user_id, course_id])
  @@index([course_id])
  @@index([user_id])
}

model Lesson {
  id       Int    @id @default(autoincrement())
  title    String
  courseId Int?

  @@index([courseId])
}

model Organization {
  id          Int     @id @default(autoincrement())
  name        String
  description String?
}

model User {
  id             Int     @id @default(autoincrement())
  auth_user_id   String  @unique
  name           String
  email          String  @unique
  organizationId Int?
  area_code      String?
  bio            String? @db.LongText
  city           String?
  country_code   String?
  phone_number   String?
  photo_url      String?
  state          String?
  role           String  @default("user")

  @@index([auth_user_id])
  @@index([organizationId])
}

model auth_key {
  id              String  @id @unique
  hashed_password String?
  auth_user_id    String

  @@index([auth_user_id])
}

model auth_session {
  id           String   @id @unique
  auth_user_id String
  expires      DateTime

  @@index([auth_user_id])
}

model auth_user {
  id      String @id @unique
  user_id Int?   @unique
  email   String @unique

  @@index([user_id])
}

model csrf_token {
  token   String @id @unique
  expires BigInt
}

model permissions {
  id              Int    @id @default(autoincrement())
  permission_type String
  resource_id     Int
  resource_type   String
  user_id         Int

  @@index([user_id])
}
